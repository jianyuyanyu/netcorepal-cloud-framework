# NetCorePal.Extensions.CodeAnalysis.Tools

åŸºäº NetCorePal ä»£ç åˆ†ææ¡†æ¶çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œç”¨äºä» .NET é¡¹ç›®ç”Ÿæˆäº¤äº’å¼æ¶æ„å¯è§†åŒ– HTML æ–‡ä»¶ã€‚

## åŠŸèƒ½ç‰¹æ€§

- **æ™ºèƒ½å‘ç°**ï¼šè‡ªåŠ¨å‘ç°å¹¶åˆ†æè§£å†³æ–¹æ¡ˆæˆ–é¡¹ç›®
- **ä¾èµ–é€’å½’åˆ†æ**ï¼šè‡ªåŠ¨åˆ†æé¡¹ç›®ä¾èµ–å…³ç³»ï¼Œç¡®ä¿å®Œæ•´çš„æ¶æ„è§†å›¾
- **å¤šç±»å‹å›¾è¡¨**ï¼šç”Ÿæˆæ¶æ„æ€»è§ˆå›¾ã€å¤„ç†æµç¨‹å›¾ã€èšåˆå…³ç³»å›¾ç­‰
- **äº¤äº’å¼HTML**ï¼šæä¾›å®Œæ•´çš„å¯¼èˆªã€å›¾è¡¨åˆ‡æ¢å’Œåœ¨çº¿ç¼–è¾‘åŠŸèƒ½
- **Mermaid Liveé›†æˆ**ï¼šä¸€é”®è·³è½¬åˆ° Mermaid Live Editor è¿›è¡Œåœ¨çº¿ç¼–è¾‘
- **.NET 10 å•æ–‡ä»¶æ‰§è¡Œ**ï¼šåˆ©ç”¨ .NET 10 çš„å•æ–‡ä»¶è¿è¡Œèƒ½åŠ›ï¼ŒåŠ¨æ€ç”Ÿæˆå’Œæ‰§è¡Œåˆ†æä»£ç 
- **ğŸ“Š å†å²è®°å½•ç‰¹æ€§**ï¼šç±»ä¼¼ EF Core è¿ç§»ï¼Œæ”¯æŒç‰ˆæœ¬å¿«ç…§ã€å†å²æ¯”è¾ƒå’Œè¶‹åŠ¿å±•ç¤º

## å¿«é€Ÿå¼€å§‹

### å‰ææ¡ä»¶

- **éœ€è¦å®‰è£… .NET 10 SDK**ï¼šå•æ–‡ä»¶æ‰§è¡Œä¾èµ– .NET 10 ç‰¹æ€§
- **SDK ä¸ç›®æ ‡æ¡†æ¶çš„åŒºåˆ«**ï¼šè™½ç„¶å·¥å…·éœ€è¦ .NET 10 SDK æ¥è¿è¡Œï¼Œä½†å®ƒå¯ä»¥åˆ†æä½¿ç”¨ `net8.0`ã€`net9.0` æˆ– `net10.0` ä½œä¸ºç›®æ ‡æ¡†æ¶çš„é¡¹ç›®
- ç›®æ ‡é¡¹ç›®å¿…é¡»å¼•ç”¨ `NetCorePal.Extensions.CodeAnalysis` åŒ…
- è¯¥åŒ…åŒ…å«æºç”Ÿæˆå™¨ï¼Œåœ¨ç¼–è¯‘æ—¶è‡ªåŠ¨ç”Ÿæˆä»£ç åˆ†æå…ƒæ•°æ®

### å®‰è£…

```bash
dotnet tool install -g NetCorePal.Extensions.CodeAnalysis.Tools
```

å®‰è£…é¢„è§ˆç‰ˆï¼š

```bash
dotnet tool install -g NetCorePal.Extensions.CodeAnalysis.Tools --prerelease  --source https://www.myget.org/F/netcorepal/api/v3/index.json
```

### ä½¿ç”¨

```bash
# è¿›å…¥é¡¹ç›®ç›®å½•
cd MyApp

# è‡ªåŠ¨å‘ç°å¹¶åˆ†æå½“å‰ç›®å½•ä¸‹çš„è§£å†³æ–¹æ¡ˆæˆ–é¡¹ç›®
netcorepal-codeanalysis generate

# æŒ‡å®šè§£å†³æ–¹æ¡ˆæ–‡ä»¶
netcorepal-codeanalysis generate --solution MySolution.sln

# æŒ‡å®šé¡¹ç›®æ–‡ä»¶
netcorepal-codeanalysis generate --project MyProject.csproj

# è‡ªå®šä¹‰è¾“å‡ºå’Œæ ‡é¢˜
netcorepal-codeanalysis generate --output my-architecture.html --title "æˆ‘çš„æ¶æ„å›¾"

# å¯ç”¨è¯¦ç»†è¾“å‡º
netcorepal-codeanalysis generate --verbose
```

### å‘½ä»¤å‚æ•°

| é€‰é¡¹ | åˆ«å | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|---|---|---|---|---|
| `--solution <solution>` | `-s` | æ–‡ä»¶è·¯å¾„ | æ—  | è¦åˆ†æçš„è§£å†³æ–¹æ¡ˆæ–‡ä»¶ï¼Œæ”¯æŒ `.sln`/`.slnx` |
| `--project <project>` | `-p` | æ–‡ä»¶è·¯å¾„ï¼ˆå¯å¤šæ¬¡ï¼‰ | æ—  | è¦åˆ†æçš„é¡¹ç›®æ–‡ä»¶ï¼ˆ`.csproj`ï¼‰ï¼Œå¯é‡å¤æŒ‡å®šå¤šä¸ª |
| `--output <output>` | `-o` | æ–‡ä»¶è·¯å¾„ | `architecture-visualization.html` | è¾“å‡ºçš„ HTML æ–‡ä»¶è·¯å¾„ |
| `--title <title>` | `-t` | å­—ç¬¦ä¸² | `æ¶æ„å¯è§†åŒ–` | ç”Ÿæˆé¡µé¢çš„æ ‡é¢˜ |
| `--verbose` | `-v` | å¼€å…³ | `false` | å¯ç”¨è¯¦ç»†æ—¥å¿—è¾“å‡º |
| `--include-tests` | æ—  | å¼€å…³ | `false` | åŒ…å«æµ‹è¯•é¡¹ç›®ï¼ˆé»˜è®¤ä¸åŒ…å«ï¼›è§„åˆ™è§ä¸‹æ–‡â€œæµ‹è¯•é¡¹ç›®è¯†åˆ«è§„åˆ™â€ï¼‰ |

### è‡ªåŠ¨å‘ç°è¡Œä¸º

- é»˜è®¤ç­–ç•¥ï¼šå½“æœªæä¾› `--solution` ä¸ `--project` æ—¶ï¼Œå·¥å…·ä¼šåœ¨â€œå½“å‰ç›®å½•ï¼ˆé¡¶å±‚ï¼‰â€è‡ªåŠ¨å‘ç°åˆ†æç›®æ ‡ã€‚
- å‘ç°ä¼˜å…ˆçº§ï¼š
  1) ä¼˜å…ˆä½¿ç”¨ `.slnx`
  2) å…¶æ¬¡ä½¿ç”¨ `.sln`
  3) è‹¥æ— è§£å†³æ–¹æ¡ˆæ–‡ä»¶ï¼Œåˆ™æ”¶é›†å½“å‰ç›®å½•é¡¶å±‚çš„ `*.csproj`
- éé€’å½’ï¼šä¸é€’å½’æ‰«æå­ç›®å½•ï¼Œä»…æ£€æŸ¥å½“å‰ç›®å½•çš„é¡¶å±‚æ–‡ä»¶ã€‚
- è¿è¡Œæ—¶æç¤ºï¼šé€‰æ‹© `.slnx/.sln` æ—¶å°†æ˜ç¡®æ‰“å°â€œUsing solution (.slnx/.sln): <æ–‡ä»¶å>â€ã€‚

å¦‚éœ€æ˜¾å¼æŒ‡å®šï¼Œæ¨èï¼š

```bash
# æŒ‡å®šè§£å†³æ–¹æ¡ˆ
netcorepal-codeanalysis generate --solution MySolution.slnx

# æˆ–æŒ‡å®šè‹¥å¹²é¡¹ç›®
netcorepal-codeanalysis generate --project A.csproj --project B.csproj
```

### æµ‹è¯•é¡¹ç›®è¯†åˆ«è§„åˆ™

- é»˜è®¤è¡Œä¸ºï¼šæµ‹è¯•é¡¹ç›®ä¼šè¢«æ’é™¤åœ¨åˆ†æä¹‹å¤–ï¼ˆé™¤éæ˜¾å¼ä¼ å…¥ `--include-tests`ï¼‰ã€‚
- åˆ¤å®šè§„åˆ™ï¼ˆæ»¡è¶³ä»»ä¸€å³è§†ä¸ºæµ‹è¯•é¡¹ç›®ï¼‰ï¼š
  - é¡¹ç›®æ–‡ä»¶æ‰€åœ¨è·¯å¾„çš„ä»»ä¸€çˆ¶çº§ç›®å½•åä¸º `test` æˆ– `tests`ï¼ˆä¸åŒºåˆ†å¤§å°å†™ï¼‰ã€‚
  - é¡¹ç›®æ–‡ä»¶ï¼ˆ.csprojï¼‰ä¸­åŒ…å« `<IsTestProject>true</IsTestProject>`ã€‚

è‹¥éœ€åŒ…å«æµ‹è¯•é¡¹ç›®ï¼Œè¯·ä½¿ç”¨ï¼š

```bash
netcorepal-codeanalysis generate --include-tests
```

## å†å²è®°å½•ç‰¹æ€§ï¼ˆç±»ä¼¼ EF Core è¿ç§»ï¼‰

å·¥å…·æä¾›äº†ç‰ˆæœ¬å¿«ç…§åŠŸèƒ½ï¼Œå¯ä»¥è¿½è¸ªæ¶æ„çš„æ¼”è¿›å†å²ï¼Œç±»ä¼¼äº Entity Framework Core çš„è¿ç§»æœºåˆ¶ã€‚

**å¿«ç…§ä»¥C#ä»£ç æ–‡ä»¶å½¢å¼ä¿å­˜**ï¼Œç±»ä¼¼EF Coreçš„è¿ç§»å¿«ç…§ï¼Œä¾¿äºç‰ˆæœ¬æ§åˆ¶å’Œä»£ç å®¡æŸ¥ã€‚

### åˆ›å»ºå¿«ç…§

```bash
# åˆ›å»ºå½“å‰é¡¹ç›®çš„æ¶æ„å¿«ç…§ï¼ˆç”Ÿæˆ .cs æ–‡ä»¶ï¼‰
netcorepal-codeanalysis snapshot add --description "åˆå§‹ç‰ˆæœ¬"

# å¿«ç…§å°†ä¿å­˜ä¸º Snapshots/Snapshot_20260116120000.cs

# åˆ›å»ºå¿«ç…§å¹¶æŒ‡å®šå­˜å‚¨ç›®å½•
netcorepal-codeanalysis snapshot add --description "æ·»åŠ è®¢å•æ¨¡å—" --snapshot-dir ./MySnapshots
```

å¿«ç…§æ–‡ä»¶ç¤ºä¾‹ï¼ˆSnapshot_20260116120000.csï¼‰ï¼š
```csharp
// <auto-generated />
// Snapshot created: 2026-01-16 12:00:00
// Description: åˆå§‹ç‰ˆæœ¬

namespace CodeAnalysisSnapshots
{
    public partial class Snapshot_20260116120000
    {
        public static CodeFlowAnalysisSnapshot BuildSnapshot()
        {
            // ... å¿«ç…§æ•°æ®
        }
    }
}
```

### æŸ¥çœ‹å¿«ç…§åˆ—è¡¨

```bash
# åˆ—å‡ºæ‰€æœ‰å¿«ç…§
netcorepal-codeanalysis snapshot list

# è¾“å‡ºç¤ºä¾‹ï¼š
# Found 3 snapshot(s):
#
# Version              Timestamp              Nodes    Relationships   Description
# ----------------------------------------------------------------------------------------------------
# 20260116120000       2026-01-16 12:00:00    45       78              æ·»åŠ è®¢å•æ¨¡å—
# 20260115100000       2026-01-15 10:00:00    38       65              é‡æ„ç”¨æˆ·æœåŠ¡
# 20260114090000       2026-01-14 09:00:00    32       52              åˆå§‹ç‰ˆæœ¬
```

### æŸ¥çœ‹å¿«ç…§è¯¦æƒ…

```bash
# æ˜¾ç¤ºæŒ‡å®šç‰ˆæœ¬çš„å¿«ç…§è¯¦ç»†ä¿¡æ¯
netcorepal-codeanalysis snapshot show 20260116120000

# ä½¿ç”¨ --verbose æ˜¾ç¤ºæ›´è¯¦ç»†çš„ç»Ÿè®¡ä¿¡æ¯
netcorepal-codeanalysis snapshot show 20260116120000 --verbose
```

### ç”Ÿæˆå¸¦å†å²è®°å½•çš„HTML

```bash
# é»˜è®¤ç”ŸæˆåŒ…å«å†å²å¿«ç…§çš„äº¤äº’å¼HTMLï¼ˆå¦‚æœå­˜åœ¨å¿«ç…§ï¼‰
netcorepal-codeanalysis generate

# ç¦ç”¨å†å²è®°å½•åŠŸèƒ½
netcorepal-codeanalysis generate --no-history

# æŒ‡å®šå¿«ç…§ç›®å½•
netcorepal-codeanalysis generate --snapshot-dir ./MySnapshots --output history.html
```

ç”Ÿæˆçš„HTMLé¡µé¢åŒ…å«ï¼š
- ğŸ“Š **ç‰ˆæœ¬é€‰æ‹©å™¨**ï¼šå¯ä»¥åˆ‡æ¢æŸ¥çœ‹ä¸åŒç‰ˆæœ¬çš„æ¶æ„ï¼ˆå¦‚æœå­˜åœ¨å¤šä¸ªå¿«ç…§ï¼‰
- ğŸ“ˆ **è¶‹åŠ¿å›¾è¡¨**ï¼šå±•ç¤ºèŠ‚ç‚¹æ•°é‡å’Œå…³ç³»æ•°é‡éšæ—¶é—´çš„å˜åŒ–è¶‹åŠ¿
- ğŸ” **ç‰ˆæœ¬å¯¹æ¯”**ï¼šé«˜äº®æ˜¾ç¤ºç‰ˆæœ¬é—´çš„å·®å¼‚
- ğŸ“ **ç‰ˆæœ¬ä¿¡æ¯**ï¼šæ˜¾ç¤ºæ¯ä¸ªç‰ˆæœ¬çš„æ—¶é—´æˆ³ã€æè¿°å’Œç»Ÿè®¡ä¿¡æ¯

**æ³¨æ„**ï¼šå¦‚æœæ²¡æœ‰å¿«ç…§æ–‡ä»¶ï¼Œå°†è‡ªåŠ¨ç”Ÿæˆä¸å«å†å²çš„HTMLã€‚

### å…¸å‹å·¥ä½œæµç¨‹

```bash
# 1. åˆå§‹æ¶æ„å¿«ç…§
netcorepal-codeanalysis snapshot add --description "é¡¹ç›®åˆå§‹ç‰ˆæœ¬"

# 2. å¼€å‘æ–°åŠŸèƒ½...

# 3. åˆ›å»ºæ–°å¿«ç…§
netcorepal-codeanalysis snapshot add --description "æ·»åŠ æ”¯ä»˜åŠŸèƒ½"

# 4. æŸ¥çœ‹å¿«ç…§å†å²
netcorepal-codeanalysis snapshot list

# 5. ç”Ÿæˆå¯è§†åŒ–ï¼ˆé»˜è®¤åŒ…å«å†å²ï¼‰
netcorepal-codeanalysis generate --output architecture.html

# 6. æäº¤å¿«ç…§åˆ°ç‰ˆæœ¬æ§åˆ¶ï¼ˆæ¨èï¼‰
git add Snapshots/
git commit -m "Add architecture snapshot"
```

### ç‰ˆæœ¬æ§åˆ¶é›†æˆ

å¿«ç…§ä»¥ C# ä»£ç æ–‡ä»¶å½¢å¼ä¿å­˜ï¼Œå»ºè®®å°†å…¶æäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿï¼š

```bash
# å°†å¿«ç…§ç›®å½•æ·»åŠ åˆ°ç‰ˆæœ¬æ§åˆ¶
git add Snapshots/
git commit -m "Add architecture snapshot: [æè¿°]"
```

**ä¼˜åŠ¿**ï¼š
- âœ… ç±»å‹å®‰å…¨ï¼Œç¼–è¯‘æ—¶æ£€æŸ¥
- âœ… æ˜“äºä»£ç å®¡æŸ¥å’Œdiff
- âœ… è‡ªç„¶é›†æˆåˆ°Gitå·¥ä½œæµ
- âœ… éµå¾ªEF Coreè¿ç§»çš„æœ€ä½³å®è·µ



è¯¥å·¥å…·é‡‡ç”¨åŸºäº .NET 10 å•æ–‡ä»¶æ‰§è¡Œèƒ½åŠ›çš„å…¨æ–°æ¶æ„ï¼š

1. **é¡¹ç›®å‘ç°**ï¼šè‡ªåŠ¨å‘ç°ç›®æ ‡è§£å†³æ–¹æ¡ˆæˆ–é¡¹ç›®æ–‡ä»¶
2. **ä¾èµ–åˆ†æ**ï¼šé€’å½’åˆ†æé¡¹ç›®å¼•ç”¨ï¼Œè·å–æ‰€æœ‰ç›¸å…³é¡¹ç›®
3. **åŠ¨æ€ä»£ç ç”Ÿæˆ**ï¼šç”ŸæˆåŒ…å« `#:project` æŒ‡ä»¤çš„ä¸´æ—¶ C# æ–‡ä»¶
4. **å•æ–‡ä»¶æ‰§è¡Œ**ï¼šä½¿ç”¨ `dotnet run app.cs` æ‰§è¡Œåˆ†æ
5. **ç»“æœç”Ÿæˆ**ï¼šç”Ÿæˆäº¤äº’å¼ HTML å¯è§†åŒ–æ–‡ä»¶
6. **è‡ªåŠ¨æ¸…ç†**ï¼šåˆ é™¤ä¸´æ—¶æ–‡ä»¶

## å®Œæ•´æ–‡æ¡£

è¯¦ç»†çš„ä½¿ç”¨è¯´æ˜ã€å‘½ä»¤è¡Œé€‰é¡¹ã€é›†æˆæ–¹å¼å’Œæ•…éšœæ’é™¤ï¼Œè¯·å‚é˜…ï¼š

- [ä¸­æ–‡æ–‡æ¡£](https://netcorepal.github.io/netcorepal-cloud-framework/zh/code-analysis/code-analysis-tools/)
- [English Documentation](https://netcorepal.github.io/netcorepal-cloud-framework/en/code-analysis/code-analysis-tools/)

## æœ¬åœ°å¼€å‘

```bash
cd src/NetCorePal.Extensions.CodeAnalysis.Tools
dotnet pack -o .
dotnet tool uninstall -g NetCorePal.Extensions.CodeAnalysis.Tools
dotnet tool install -g NetCorePal.Extensions.CodeAnalysis.Tools --add-source .

# test
dotnet test test/NetCorePal.Extensions.CodeAnalysis.Tools.UnitTests/NetCorePal.Extensions.CodeAnalysis.Tools.UnitTests.csproj
```
